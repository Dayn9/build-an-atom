<!DOCTYPE HTML>
<!-- Copyright 2002-2015, University of Colorado Boulder -->

<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1"/>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="phet-sim-level" content="production">
  <title>&#8234;Build an Atom&#8236; PostMessage API test</title>
</head>
<body bgcolor="#FFFACD">
<style>
  body {
    font-family: Arial, Helvetica, sans-serif
  }
</style>
<h1>PostMessage API test</h1>

<p>The simulation should be embedded below:</p>

<iframe id="iframe" width="600" height="400" allowfullscreen scrolling="no"></iframe>
<script type="application/javascript">
  var suffix = window.location.search || '';
  var simIframe = document.getElementById( 'iframe' )

  window.addEventListener( 'message', function( event ) {
    console.log( event );
    if ( event.data.protocol === '1.0.0-phet' && event.data.response === 'endedSimConstruction' ) {

      // TODO: for production sims, this should only work for sims that are on our site, replace the '*' origin
      // with phet.colorado.edu (or something)
      simIframe.contentWindow.postMessage( { protocol:'1.0.0-phet', instance: 'phet.joist.sim', method: 'getTitle' }, '*' );
    }
    if ( event.data.protocol === '1.0.0-phet' && event.data.response && event.data.request ) {
      console.log( event.data.response );
    }
  } );

  simIframe.setAttribute( 'src', 'build-an-atom_en.html' + suffix );

</script>
</body>
</html>
